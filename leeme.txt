# Renderside API - GuÃ­a de InstalaciÃ³n y EjecuciÃ³n

## ğŸ“‹ Requisitos del Sistema

- **Node.js**: VersiÃ³n 14.x o superior (recomendado: Node.js 18+ para mejor compatibilidad)
- **npm**: Incluido con Node.js
- **Sistema Operativo**: Windows, macOS, o Linux
- **Memoria RAM**: MÃ­nimo 512MB disponible
- **Espacio en disco**: 200MB para dependencias

## ğŸš€ InstalaciÃ³n

### 1. Clonar o descargar el proyecto
```bash
cd ruta/del/proyecto/renderside
```

### 2. Instalar dependencias
```bash
npm install
```

**Dependencias principales que se instalarÃ¡n:**
- `express`: Framework web para Node.js
- `jsonwebtoken`: Manejo de tokens JWT para autenticaciÃ³n
- `sqlite3` & `sqlite`: Base de datos local SQLite
- `cors`: Manejo de CORS para requests desde diferentes dominios
- `body-parser`: Parser de cuerpos de requests HTTP
- `nodemailer`: EnvÃ­o de emails para recuperaciÃ³n de contraseÃ±a
- `dotenv`: Carga de variables de entorno desde archivo .env

### 3. Configurar variables de entorno

Crear archivo `.env` en la raÃ­z del proyecto con las siguientes variables:

```env
# Clave secreta para firmar tokens JWT (REQUERIDA)
secret=tu_clave_secreta_muy_segura_aqui

# Puerto del servidor (opcional, por defecto: 3000)
PORT=3000

# ConfiguraciÃ³n de CORS (opcional, por defecto: *)
CORS_ORIGIN=*

# Entorno de ejecuciÃ³n (opcional)
NODE_ENV=development
```

**âš ï¸ IMPORTANTE:** El archivo `.env` ya existe y contiene una clave secreta. NO lo modifiques a menos que sepas lo que haces.

## ğŸ¯ EjecuciÃ³n

### Modo desarrollo (recomendado)
```bash
npm start
```

### EjecuciÃ³n directa
```bash
node server.js
```

### Con variables de entorno especÃ­ficas
```bash
PORT=8080 NODE_ENV=production npm start
```

## âœ… VerificaciÃ³n de la instalaciÃ³n

Si todo estÃ¡ correcto, deberÃ­as ver en la consola:
```
ğŸš€ Server running on port 3000
ğŸŒ Environment: development
ğŸ” JWT Secret: âœ… Loaded
ğŸ”— CORS Origin: *
ğŸ“Š Database: SQLite initialized
â° Started at: 2025-10-13T...
```

### Probar la API
Abre tu navegador o herramienta como Postman y accede a:
- **Health Check**: `http://localhost:3000/`
- **Crear usuario**: `http://localhost:3000/auth/create/test@email.com/password123/NombreUsuario`

## ğŸ“ Estructura del Proyecto

```
app/
â”œâ”€â”€ .env                    # Variables de entorno (JWT secret, etc.)
â”œâ”€â”€ .data/                  # Base de datos SQLite (se crea automÃ¡ticamente)
â”œâ”€â”€ images/                 # ImÃ¡genes de perfil de usuarios
â”œâ”€â”€ package.json           # Dependencias y scripts
â”œâ”€â”€ server.js              # Archivo principal del servidor
â””â”€â”€ src/
    â”œâ”€â”€ router.js          # ConfiguraciÃ³n de rutas principales
    â”œâ”€â”€ helpers/
    â”‚   â””â”€â”€ jwt.js         # Helper para manejo de JWT
    â”œâ”€â”€ middleware/
    â”‚   â”œâ”€â”€ validateToken.js    # ValidaciÃ³n de autenticaciÃ³n
    â”‚   â””â”€â”€ validateLevel.js    # ValidaciÃ³n de niveles de usuario
    â”œâ”€â”€ routes/            # Rutas de la API
    â”‚   â”œâ”€â”€ auth.js        # AutenticaciÃ³n y registro
    â”‚   â”œâ”€â”€ user.js        # Perfil y datos de usuario
    â”‚   â”œâ”€â”€ codes.js       # CÃ³digos VR temporales
    â”‚   â”œâ”€â”€ license.js     # GestiÃ³n de licencias (supervisores)
    â”‚   â”œâ”€â”€ results.js     # Resultados VR (supervisores)
    â”‚   â””â”€â”€ modules.js     # MÃ³dulos educativos
    â””â”€â”€ utils/
        â””â”€â”€ sqlite.js      # ConfiguraciÃ³n de base de datos
```

## ğŸ”§ ConfiguraciÃ³n Avanzada

### Cambiar puerto de escucha
En el archivo `.env`, modificar:
```env
PORT=8080
```

### Configurar CORS para producciÃ³n
```env
CORS_ORIGIN=https://tudominio.com
```

### Habilitar logs de desarrollo
```env
NODE_ENV=development
```

## ğŸ—„ï¸ Base de Datos

La aplicaciÃ³n usa **SQLite** y se inicializa automÃ¡ticamente en el primer arranque:
- **UbicaciÃ³n**: `./.data/roadsproject.db`
- **Tablas creadas**: Users, Codes, Modules, Results
- **Datos iniciales**: 3 usuarios administradores pre-configurados

### Usuarios pre-configurados:
- `gunderwulde@gmail.com` (Nivel 999 - Admin)
- `angel.gil@renderside.com` (Nivel 999 - Admin)  
- `alfonso.cortes@ac2sc.es` (Nivel 999 - Admin)

## ğŸ›¡ï¸ Seguridad

- Las contraseÃ±as estÃ¡n hasheadas con SHA-1 (âš ï¸ considerar migrar a bcrypt)
- Tokens JWT con expiraciÃ³n configurable
- ValidaciÃ³n de niveles de usuario por rutas
- CORS configurable para diferentes entornos

## ğŸ› SoluciÃ³n de Problemas

### Error: "SECRET environment variable is required"
- Verificar que el archivo `.env` existe y contiene `secret=...`

### Error: "EADDRINUSE" (puerto en uso)
- Cambiar el puerto en `.env` o cerrar la aplicaciÃ³n que usa el puerto 3000

### Error de dependencias
- Eliminar `node_modules` y ejecutar `npm install` nuevamente
- Verificar versiÃ³n de Node.js: `node --version`

### Base de datos corrupta
- Eliminar archivo `.data/roadsproject.db` (se recrearÃ¡ automÃ¡ticamente)

## ğŸ“š API Endpoints Principales

- **POST** `/auth/:email/:password` - Login
- **GET** `/auth/create/:email/:password/:name` - Registro
- **GET** `/user/` - Perfil de usuario (requiere token)
- **GET** `/codes/validate/:code` - Validar cÃ³digo VR
- **GET** `/modules/` - MÃ³dulos educativos (requiere token)
- **GET** `/license/userslist/:offset/:limit` - Lista usuarios (supervisor)

## ğŸ”„ Actualizaciones

Para actualizar dependencias:
```bash
npm update
```

Para verificar vulnerabilidades:
```bash
npm audit
npm audit fix
```

---

**ğŸ“§ Soporte**: Para problemas tÃ©cnicos, revisar logs de consola y verificar configuraciÃ³n de `.env`